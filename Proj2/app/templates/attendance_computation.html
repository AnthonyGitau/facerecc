{% extends "dashboard.html" %}


{% block element %}
<body class="bg-dark">
  <div class="container">

    {% with messages = get_flashed_messages() %}
      {% if messages %}
      <div class="card card-register mx-auto mt-5">
        {% for message in messages %}
          <div class="card text-white bg-primary o-hidden h-100">
            <div class="card-body">
              <div class="mr-5"></div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="#">
              <span class="float-left">{{ message }}</span>
            </a>
          </div>
        {% endfor %}
     </div>
        {% endif %}
     {% endwith %}
       <div class="breadcrumb_div">
         
       <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="#">Dashboard</a>
            </li>
            <li class="breadcrumb-item active">Attendance Computation</li>
        </ol>
       </div>

     <h2>Unit Attendance Computation</h2>
     <div class="row">
        <div class="col-md-6">
          <label>Unit</label>
            <select class="form-control" id="course">
              {% for unit in units %}
	                <option value="{{ unit.id }}"> {{ unit.code }} - {{ unit.name }} </option>
              {% endfor %}
            </select>
        </div>
        <div class="col-md-6">
          <label>Student</label>
            <select class="form-control" id="students">
            </select>
        </div>
    </div>
  </div>
</body>

<style type="text/css">
  .breadcrumb_div {
    margin-top: 50px;
  }
</style>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
  function computeStudent() {
    var unit_id = $('#course').val();
    var student_id = $('#students').val();
    $.ajax({
      'url': `/compute_unit_student_attendance/${unit_id}/${student_id}`,
      success: function(data) {
        console.log(data);
      }
    })
  }

  function updateStudents() {
      var unit_id = $('#course').val();
      $.ajax({
        url: `/get_unit_registered_students/${unit_id}`,
        success: function(data) {
          console.log(data);
          if (!data) {

          } else {
            $('#students').empty();
            $.each(data, function(index, student){
              $('#students').append(`
                <option value="${student.id}">
                  ${student.id} - ${student.first_name} ${student.last_name} 
                </option>
                `)
            });
          }
        }
      })
  };

  $(document).ready(function(){
    var unit_id = $('#course').val();
    updateStudents(unit_id);

    $('#course').on('change', function(event){
        event.preventDefault();
        updateStudents();
    });

    $('#students').on('change', function(index, student){
      computeStudent();
    })
  })
</script>
{% endblock %}



